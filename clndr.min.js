(function(e,c,a,h){var b="<div class='clndr-controls'><div class='clndr-control-button'><span class='clndr-previous-button'>previous</span></div><div class='month'><%= month %> <%= year %></div><div class='clndr-control-button rightalign'><span class='clndr-next-button'>next</span></div></div><table class='clndr-table' border='0' cellspacing='0' cellpadding='0'><thead><tr class='header-days'><% for(var i = 0; i < daysOfTheWeek.length; i++) { %><td class='header-day'><%= daysOfTheWeek[i] %></td><% } %></tr></thead><tbody><% for(var i = 0; i < numberOfRows; i++){ %><tr><% for(var j = 0; j < 7; j++){ %><% var d = j + i * 7; %><td class='<%= days[d].classes %>'><div class='day-contents'><%= days[d].day %></div></td><% } %></tr><% } %></tbody></table>";var d="clndr";var f={template:b,weekOffset:0,startWithMonth:null,clickEvents:{click:null,nextMonth:null,previousMonth:null,nextYear:null,previousYear:null,today:null,onMonthChange:null,onYearChange:null},targets:{nextButton:"clndr-next-button",previousButton:"clndr-previous-button",nextYearButton:"clndr-next-year-button",previousYearButton:"clndr-previous-year-button",todayButton:"clndr-today-button",day:"day",empty:"empty"},events:[],extras:null,dateParameter:"date",multiDayEvents:null,doneRendering:null,render:null,daysOfTheWeek:null,showAdjacentMonths:true,adjacentDaysChangeMonth:false,ready:null,constraints:null,forceSixRows:null};function g(k,j){this.element=k;this.options=e.extend(true,{},f,j);if(this.options.events.length){if(this.options.multiDayEvents){this.options.events=this.addMultiDayMomentObjectsToEvents(this.options.events)}else{this.options.events=this.addMomentObjectToEvents(this.options.events)}}if(this.options.startWithMonth){this.month=moment(this.options.startWithMonth).startOf("month")}else{this.month=moment().startOf("month")}if(this.options.constraints){if(this.options.constraints.startDate){var l=moment(this.options.constraints.startDate);if(this.month.isBefore(l,"month")){this.month.set("month",l.month());this.month.set("year",l.year())}}if(this.options.constraints.endDate){var i=moment(this.options.constraints.endDate);if(this.month.isAfter(i,"month")){this.month.set("month",i.month()).set("year",i.year())}}}this._defaults=f;this._name=d;this.init()}g.prototype.init=function(){this.daysOfTheWeek=this.options.daysOfTheWeek||[];if(!this.options.daysOfTheWeek){this.daysOfTheWeek=[];for(var j=0;j<7;j++){this.daysOfTheWeek.push(moment().weekday(j).format("dd").charAt(0))}}if(this.options.weekOffset){this.daysOfTheWeek=this.shiftWeekdayLabels(this.options.weekOffset)}if(!e.isFunction(this.options.render)){this.options.render=null;if(typeof _==="undefined"){throw new Error("Underscore was not found. Please include underscore.js OR provide a custom render function.")}else{this.compiledClndrTemplate=_.template(this.options.template)}}e(this.element).html("<div class='clndr'></div>");this.calendarContainer=e(".clndr",this.element);this.bindEvents();this.render();if(this.options.ready){this.options.ready.apply(this,[])}};g.prototype.shiftWeekdayLabels=function(k){var l=this.daysOfTheWeek;for(var j=0;j<k;j++){l.push(l.shift())}return l};g.prototype.createDaysObject=function(p){daysArray=[];var k=p.startOf("month");this.eventsLastMonth=[];this.eventsThisMonth=[];this.eventsNextMonth=[];if(this.options.events.length){if(this.options.multiDayEvents){this.eventsThisMonth=e(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")<=p.format("YYYY-MM")||p.format("YYYY-MM")<=this._clndrEndDateObject.format("YYYY-MM")}).toArray();if(this.options.showAdjacentMonths){var o=p.clone().subtract("months",1);var n=p.clone().add("months",1);this.eventsLastMonth=e(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")<=o.format("YYYY-MM")||o.format("YYYY-MM")<=this._clndrEndDateObject.format("YYYY-MM")}).toArray();this.eventsNextMonth=e(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")<=n.format("YYYY-MM")||n.format("YYYY-MM")<=this._clndrEndDateObject.format("YYYY-MM")}).toArray()}}else{this.eventsThisMonth=e(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==p.format("YYYY-MM")}).toArray();if(this.options.showAdjacentMonths){var o=p.clone().subtract("months",1);var n=p.clone().add("months",1);this.eventsLastMonth=e(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==o.format("YYYY-MM")}).toArray();this.eventsNextMonth=e(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==n.format("YYYY-MM")}).toArray()}}}var r=k.weekday()-this.options.weekOffset;if(r<0){r+=7}if(this.options.showAdjacentMonths){for(var m=0;m<r;m++){var q=moment([p.year(),p.month(),m-r+1]);daysArray.push(this.createDayObject(q,this.eventsLastMonth))}}else{for(var m=0;m<r;m++){daysArray.push(this.calendarDay({classes:this.options.targets.empty+" last-month"}))}}var l=k.daysInMonth();for(var m=1;m<=l;m++){var q=moment([p.year(),p.month(),m]);daysArray.push(this.createDayObject(q,this.eventsThisMonth))}var m=1;while(daysArray.length%7!==0){if(this.options.showAdjacentMonths){var q=moment([p.year(),p.month(),l+m]);daysArray.push(this.createDayObject(q,this.eventsNextMonth))}else{daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"}))}m++}if(this.options.forceSixRows&&daysArray.length!==42){var j=moment(daysArray[daysArray.length-1].date).add("days",1);while(daysArray.length<42){if(this.options.showAdjacentMonths){daysArray.push(this.createDayObject(moment(j),this.eventsNextMonth));j.add("days",1)}else{daysArray.push(this.calendarDay({classes:this.options.targets.empty+" next-month"}))}}}return daysArray};g.prototype.createDayObject=function(s,q){var r=[];var k=moment();var t=this;var p=0,m=q.length;for(p;p<m;p++){if(t.options.multiDayEvents){var i=q[p]._clndrStartDateObject;var o=q[p]._clndrEndDateObject;if((s.isSame(i,"day")||s.isAfter(i,"day"))&&(s.isSame(o,"day")||s.isBefore(o,"day"))){r.push(q[p])}}else{if(q[p]._clndrDateObject.date()==s.date()){r.push(q[p])}}}var n="";if(k.format("YYYY-MM-DD")==s.format("YYYY-MM-DD")){n+=" today"}if(s.isBefore(k,"day")){n+=" past"}if(r.length){n+=" event"}if(this.month.month()>s.month()){n+=" adjacent-month";this.month.year()===s.year()?n+=" last-month":n+=" next-month"}else{if(this.month.month()<s.month()){n+=" adjacent-month";this.month.year()===s.year()?n+=" next-month":n+=" last-month"}}if(this.options.constraints){if(this.options.constraints.startDate&&s.isBefore(moment(this.options.constraints.startDate))){n+=" inactive"}if(this.options.constraints.endDate&&s.isAfter(moment(this.options.constraints.endDate))){n+=" inactive"}if(this.options.constraints.invalidDates&&e.isArray(this.options.constraints.invalidDates)){e.each(this.options.constraints.invalidDates,function(l,j){if(!s.isBefore(moment(j))&&!s.isAfter(moment(j))){n+=" inactive"}})}}if(!s.isValid()&&s.hasOwnProperty("_d")&&s._d!=h){s=moment(s._d)}n+=" calendar-day-"+s.format("YYYY-MM-DD");n+=" calendar-dow-"+s.weekday();return this.calendarDay({day:s.date(),classes:this.options.targets.day+n,events:r,date:s})};g.prototype.render=function(){this.calendarContainer.children().remove();var m=this.createDaysObject(this.month);var j=this.month;var k={daysOfTheWeek:this.daysOfTheWeek,numberOfRows:Math.ceil(m.length/7),days:m,month:this.month.format("MMMM"),year:this.month.year(),eventsThisMonth:this.eventsThisMonth,eventsLastMonth:this.eventsLastMonth,eventsNextMonth:this.eventsNextMonth,extras:this.options.extras};if(!this.options.render){this.calendarContainer.html(this.compiledClndrTemplate(k))}else{this.calendarContainer.html(this.options.render.apply(this,[k]))}if(this.options.constraints){for(target in this.options.targets){if(target!=this.options.targets.day){this.element.find("."+this.options.targets[target]).toggleClass("inactive",false)}}var l=null;var i=null;if(this.options.constraints.startDate){l=moment(this.options.constraints.startDate)}if(this.options.constraints.endDate){i=moment(this.options.constraints.endDate)}if(l&&this.month.isSame(l,"month")){this.element.find("."+this.options.targets.previousButton).toggleClass("inactive",true)}if(i&&this.month.isSame(i,"month")){this.element.find("."+this.options.targets.nextButton).toggleClass("inactive",true)}if(l&&moment(l).subtract("years",1).isBefore(moment(this.month).subtract("years",1))){this.element.find("."+this.options.targets.previousYearButton).toggleClass("inactive",true)}if(i&&moment(i).add("years",1).isAfter(moment(this.month).add("years",1))){this.element.find("."+this.options.targets.nextYearButton).toggleClass("inactive",true)}if((l&&l.isAfter(moment(),"month"))||(i&&i.isBefore(moment(),"month"))){this.element.find("."+this.options.targets.today).toggleClass("inactive",true)}}if(this.options.doneRendering){this.options.doneRendering.apply(this,[])}};g.prototype.bindEvents=function(){var j=e(this.element);var i=this;j.on("click","."+this.options.targets.day,function(k){if(i.options.clickEvents.click){var l=i.buildTargetObject(k.currentTarget,true);i.options.clickEvents.click.apply(i,[l])}if(i.options.adjacentDaysChangeMonth){if(e(k.currentTarget).is(".last-month")){i.backActionWithContext(i)}else{if(e(k.currentTarget).is(".next-month")){i.forwardActionWithContext(i)}}}});j.on("click","."+this.options.targets.empty,function(k){if(i.options.clickEvents.click){var l=i.buildTargetObject(k.currentTarget,false);i.options.clickEvents.click.apply(i,[l])}if(i.options.adjacentDaysChangeMonth){if(e(k.currentTarget).is(".last-month")){i.backActionWithContext(i)}else{if(e(k.currentTarget).is(".next-month")){i.forwardActionWithContext(i)}}}});j.on("click","."+this.options.targets.previousButton,{context:this},this.backAction).on("click","."+this.options.targets.nextButton,{context:this},this.forwardAction).on("click","."+this.options.targets.todayButton,{context:this},this.todayAction).on("click","."+this.options.targets.nextYearButton,{context:this},this.nextYearAction).on("click","."+this.options.targets.previousYearButton,{context:this},this.previousYearAction)};g.prototype.buildTargetObject=function(m,l){var k={element:m,events:[],date:null};if(l){var j;var i=m.className.indexOf("calendar-day-");if(i!==0){j=m.className.substring(i+13,i+23);k.date=moment(j)}else{k.date=null}if(this.options.events){if(this.options.multiDayEvents){k.events=e.makeArray(e(this.options.events).filter(function(){return((k.date.isSame(this._clndrStartDateObject,"day")||k.date.isAfter(this._clndrStartDateObject,"day"))&&(k.date.isSame(this._clndrEndDateObject,"day")||k.date.isBefore(this._clndrEndDateObject,"day")))}))}else{k.events=e.makeArray(e(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM-DD")==j}))}}}return k};g.prototype.forwardAction=function(j){var i=j.data.context;i.forwardActionWithContext(i)};g.prototype.backAction=function(j){var i=j.data.context;i.backActionWithContext(i)};g.prototype.backActionWithContext=function(i){if(i.element.find("."+i.options.targets.previousButton).hasClass("inactive")){return}var j=!i.month.isSame(moment(i.month).subtract("months",1),"year");i.month.subtract("months",1);i.render();if(i.options.clickEvents.previousMonth){i.options.clickEvents.previousMonth.apply(i,[moment(i.month)])}if(i.options.clickEvents.onMonthChange){i.options.clickEvents.onMonthChange.apply(i,[moment(i.month)])}if(j){if(i.options.clickEvents.onYearChange){i.options.clickEvents.onYearChange.apply(i,[moment(i.month)])}}};g.prototype.forwardActionWithContext=function(i){if(i.element.find("."+i.options.targets.nextButton).hasClass("inactive")){return}var j=!i.month.isSame(moment(i.month).add("months",1),"year");i.month.add("months",1);i.render();if(i.options.clickEvents.nextMonth){i.options.clickEvents.nextMonth.apply(i,[moment(i.month)])}if(i.options.clickEvents.onMonthChange){i.options.clickEvents.onMonthChange.apply(i,[moment(i.month)])}if(j){if(i.options.clickEvents.onYearChange){i.options.clickEvents.onYearChange.apply(i,[moment(i.month)])}}};g.prototype.todayAction=function(k){var i=k.data.context;var j=!i.month.isSame(moment(),"month");var l=!i.month.isSame(moment(),"year");i.month=moment().startOf("month");if(i.options.clickEvents.today){i.options.clickEvents.today.apply(i,[moment(i.month)])}if(j){i.render();i.month=moment();if(i.options.clickEvents.onMonthChange){i.options.clickEvents.onMonthChange.apply(i,[moment(i.month)])}if(l){if(i.options.clickEvents.onYearChange){i.options.clickEvents.onYearChange.apply(i,[moment(i.month)])}}}};g.prototype.nextYearAction=function(j){var i=j.data.context;if(i.element.find("."+i.options.targets.nextYearButton).hasClass("inactive")){return}i.month.add("years",1);i.render();if(i.options.clickEvents.nextYear){i.options.clickEvents.nextYear.apply(i,[moment(i.month)])}if(i.options.clickEvents.onMonthChange){i.options.clickEvents.onMonthChange.apply(i,[moment(i.month)])}if(i.options.clickEvents.onYearChange){i.options.clickEvents.onYearChange.apply(i,[moment(i.month)])}};g.prototype.previousYearAction=function(j){var i=j.data.context;if(i.element.find("."+i.options.targets.previousYear).hasClass("inactive")){return}i.month.subtract("years",1);i.render();if(i.options.clickEvents.previousYear){i.options.clickEvents.previousYear.apply(i,[moment(i.month)])}if(i.options.clickEvents.onMonthChange){i.options.clickEvents.onMonthChange.apply(i,[moment(i.month)])}if(i.options.clickEvents.onYearChange){i.options.clickEvents.onYearChange.apply(i,[moment(i.month)])}};g.prototype.forward=function(i){this.month.add("months",1);this.render();if(i&&i.withCallbacks){if(this.options.clickEvents.onMonthChange){this.options.clickEvents.onMonthChange.apply(this,[moment(this.month)])}if(this.month.month()===0&&this.options.clickEvents.onYearChange){this.options.clickEvents.onYearChange.apply(this,[moment(this.month)])}}return this};g.prototype.back=function(i){this.month.subtract("months",1);this.render();if(i&&i.withCallbacks){if(this.options.clickEvents.onMonthChange){this.options.clickEvents.onMonthChange.apply(this,[moment(this.month)])}if(this.month.month()===11&&this.options.clickEvents.onYearChange){this.options.clickEvents.onYearChange.apply(this,[moment(this.month)])}}return this};g.prototype.next=function(i){this.forward(i);return this};g.prototype.previous=function(i){this.back(i);return this};g.prototype.setMonth=function(j,i){this.month.month(j);this.render();if(i&&i.withCallbacks){if(this.options.clickEvents.onMonthChange){this.options.clickEvents.onMonthChange.apply(this,[moment(this.month)])}}return this};g.prototype.nextYear=function(i){this.month.add("year",1);this.render();if(i&&i.withCallbacks){if(this.options.clickEvents.onYearChange){this.options.clickEvents.onYearChange.apply(this,[moment(this.month)])}}return this};g.prototype.previousYear=function(i){this.month.subtract("year",1);this.render();if(i&&i.withCallbacks){if(this.options.clickEvents.onYearChange){this.options.clickEvents.onYearChange.apply(this,[moment(this.month)])}}return this};g.prototype.setYear=function(j,i){this.month.year(j);this.render();if(i&&i.withCallbacks){if(this.options.clickEvents.onYearChange){this.options.clickEvents.onYearChange.apply(this,[moment(this.month)])}}return this};g.prototype.setEvents=function(i){if(this.options.multiDayEvents){this.options.events=this.addMultiDayMomentObjectsToEvents(i)}else{this.options.events=this.addMomentObjectToEvents(i)}this.render();return this};g.prototype.addEvents=function(i){if(this.options.multiDayEvents){this.options.events=e.merge(this.options.events,this.addMultiDayMomentObjectsToEvents(i))}else{this.options.events=e.merge(this.options.events,this.addMomentObjectToEvents(i))}this.render();return this};g.prototype.addMomentObjectToEvents=function(n){var k=this;var m=0,j=n.length;for(m;m<j;m++){n[m]._clndrDateObject=moment(n[m][k.options.dateParameter])}return n};g.prototype.addMultiDayMomentObjectsToEvents=function(n){var k=this;var m=0,j=n.length;for(m;m<j;m++){n[m]._clndrStartDateObject=moment(n[m][k.options.multiDayEvents.startDate]);n[m]._clndrEndDateObject=moment(n[m][k.options.multiDayEvents.endDate])}return n};g.prototype.calendarDay=function(i){var j={day:"",classes:this.options.targets.empty,events:[],date:null};return e.extend({},j,i)};e.fn.clndr=function(i){if(this.length===1){if(!this.data("plugin_clndr")){var j=new g(this,i);this.data("plugin_clndr",j);return j}}else{if(this.length>1){throw new Error("CLNDR does not support multiple elements yet. Make sure your clndr selector returns only one element.")}}}})(jQuery,window,document);